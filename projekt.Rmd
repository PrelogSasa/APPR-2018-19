---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Saša Prelog"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

Izbrala sem si temo analiza odlaganja odpadkov v Sloveniji

V svojem projektu si bom ogledala odlaganje odpadkov in ravnanje z njimi skozi leta v Sloveniji. Primerjala bom statistične regije po količini odpadkov, ki jih proizvedejo tako posamezniki kot podjetja, primerjala jih bom tudi po količini odpadkov na prebivalca. Poskusila bom poiskati povezave med starostjo in izobraženostjo prebivalcev ter količino odpadkov, ki jih proizvedejo. Rada bi našla tudi povezave med vlaganjem regij v varovanje okolja in količino proizvedenih odpadkov, ter količino ločenih odpadkov.

Moj cilj je prikazati, da večja izobraženost in vlaganje v varovanje okolja spreminjajo, kako ravnamo z odpadki.

* Tabela 1: Nastale količine komunalnih odpadkov glede na vrsto odpadkov: vrsta odpadkov, leto, tone
* Tabela 2: Količina komunalnih odpadkov glede na način predelave: način predelave, leto, tone
* Tabela 3: Količina nastalih odpadkov v tonah po regijah: regije, leto, tone
* Tabela 4: Procent  (od nastalih) ločeno zbranih odpadkov po regijah: regije, leto, delež(%)
* Tabela 5: Investicije v boljše ravnanje z odpadki po regijah: regije, leta, v 1000EUR, v % od regionalnega BDP
* Tabela 6: Izobrazba po regijah (iz 2002): regije, osnovnošolska izobrazba, srednja izobrazba, višja izobrazba
* Tabela 7: Starostne skupine po regijah: regije, leta, 0-14/15-64/65 in več

Vir podatkov: [SURS](https://pxweb.stat.si/pxweb/Database/Okolje/Okolje.asp)

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Uvozili smo podatke o občinah v obliki CSV s statističnega urada. Podatke imamo v sedmih razpredelnicah v obliki *tidy data*.

1. `druzine` - podatki o družinah za vsako občino
  - `obcina` - spremenljivka: ime občine (neurejen faktor),
  - `velikost.druzine` - spremenljivka: število otrok v družini (število: 1, 2, 3 ali 4, kjer zadnja vrednost pomeni 4 ali več),
  - `stevilo.druzin` - meritev: število družin z ustreznim številom otrok v ustrezni občini (število).

2. `obcine` - podatki o občinah
  - `obcina` - spremenljivka: ime občine (neurejen faktor),
  - `povrsina` - meritev: površina občine v km$^2$ (število),
  - `prebivalci` - meritev: prebivalstvo občine (število),
  - `gostota` - meritev: število prebivalcev na km$^2$ (število),
  - `naselja` - meritev: število naselij v občini (število),
  - `ustanovitev` - meritev: leto ustanovitve občine (število),
  - `pokrajina` - meritev: pokrajina, ki ji občina pripada (neurejen faktor),
  - `regija` - meritev: regija, ki ji občina pripada (neurejen faktor),
  - `odcepitev` - meritev: podatki o občinah, od katerih se je občina odcepila (besedilo).

Spodnji graf prikazuje porazdelitev števila naselij v občinah.

```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
ggplot(obcine, aes(x=naselja)) + geom_histogram() +
  ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin")
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
#source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data=left_join(zemljevid, povprecja, by=c("OB_UIME"="obcina")),
                        aes(x=long, y=lat, group=group, fill=povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill=guide_colorbar(title="Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
#source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny, echo=FALSE}
#shinyAppDir("shiny", options=list(width="100%", height=600))
```
